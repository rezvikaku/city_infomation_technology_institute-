<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সিটি ইনফরমেশন টেকনোলজি ইন্সটিটিউট - ভর্তি চলছে</title>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, orderBy, limit, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firestore লগিং ডিবাগ মোডে সেট করা হলো
        setLogLevel('Debug');

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // গ্লোবাল ভেরিয়েবল সেট করা
        window.db = null;
        window.auth = null;

        if (Object.keys(firebaseConfig).length > 0) {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);
            window.appId = appId; // অ্যাপ আইডি গ্লোবাল করা হলো
        } else {
            console.error("Firebase Configuration is missing.");
        }

        // Auth Listener এবং ইনিশিয়ালাইজেশন
        window.isAuthReady = false;
        window.currentUserId = null;
        window.currentUserRole = 'guest';
        window.currentUserName = 'Guest';

        if (window.auth) {
            onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    window.currentUserId = user.uid;
                    // ইউজার রোল এবং নাম Firestore থেকে লোড করা
                    const userRef = doc(window.db, `artifacts/${window.appId}/users/${user.uid}/user_data/profile`);
                    const docSnap = await getDoc(userRef);
                    
                    if (docSnap.exists() && !user.isAnonymous) {
                        const data = docSnap.data();
                        window.currentUserRole = data.role || 'student';
                        window.currentUserName = data.name || user.email.split('@')[0];
                        
                    } else if (user.isAnonymous) {
                        window.currentUserRole = 'guest';
                        window.currentUserName = 'Guest';
                    } else {
                        // যদি প্রোফাইল ডেটা না থাকে, ডিফল্ট রোল 'student'
                        window.currentUserRole = 'student';
                        window.currentUserName = user.email ? user.email.split('@')[0] : 'User';
                    }
                    console.log("Logged in user:", user.uid, "Role:", window.currentUserRole, "Name:", window.currentUserName);
                } else {
                    window.currentUserId = crypto.randomUUID(); // আনঅথেন্টিকেটেড ইউজার
                    window.currentUserRole = 'guest';
                    window.currentUserName = 'Guest';
                    console.log("User is signed out or anonymous.");
                }
                window.isAuthReady = true;
                updateUIForUser(); // UI আপডেট করা হলো
            });

            // কাস্টম টোকেন বা অ্যানোনিমাস সাইন-ইন
            const initAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(window.auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(window.auth);
                    }
                } catch (error) {
                    console.error("Initial authentication failed:", error);
                }
            };
            initAuth();
        }
    </script>
    <!-- Tailwind CSS লোড করা হচ্ছে -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (Facebook icon এর জন্য) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Baloo+Da+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ফন্ট সেট করা হচ্ছে: বাংলা লেখার জন্য 'Baloo Da 2' ব্যবহার করা হলো */
        body {
            font-family: 'Baloo Da 2', 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .section-header {
            border-bottom: 4px solid #10b981; /* Emerald-500 */
            padding-bottom: 8px;
            display: inline-block;
            margin-bottom: 20px;
        }
        /* কাস্টম অ্যানিমেশনের জন্য স্টাইল */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in.appear {
            opacity: 1;
            transform: translateY(0);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
        }
        .animate-hero {
            animation: fadeInDown 1s ease-out;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                transform: translateY(0);
            }
        }
        /* মডাল স্টাইল */
        .modal {
            display: none; /* ডিফল্টভাবে লুকানো */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 30px;
            border-radius: 12px;
            width: 90%; 
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        /* Loader style for AI button */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10b981; /* Emerald-500 */
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* গ্যালারি ক্যাপশনের উচ্চতা স্থির রাখা */
        .gallery-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 280px; /* কার্ডের ন্যূনতম উচ্চতা স্থির রাখা হলো */
        }
        .gallery-description {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        /* এআই চ্যাট বক্স স্টাইল */
        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f8fafc;
            padding: 10px;
        }
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 80%;
        }
        .user-message {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            margin-left: auto;
            text-align: right;
        }
        .ai-message {
            background-color: #ecfdf5; /* Emerald-50 */
            color: #065f46; /* Emerald-700 */
            margin-right: auto;
            text-align: left;
            border: 1px solid #a7f3d0;
        }
    </style>
</head>
<body>

    <!-- হেডার/নেভিগেশন বার -->
    <header class="bg-indigo-700 text-white shadow-lg sticky top-0 z-10">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <!-- লোগো: শুধুমাত্র পূর্ণ নাম ব্যবহার করে -->
            <a href="#home" class="flex items-center hover:text-amber-300 transition duration-300">
                <div class="leading-tight text-left">
                    <h1 class="text-lg md:text-xl font-extrabold text-amber-400">
                        সিটি ইনফরমেশন টেকনোলজি ইন্সটিটিউট
                    </h1>
                    <p class="text-xs text-indigo-200 block">
                        স্কুল এন্ড কলেজ | স্থাপিত ২০১১ (১৪ বছরের পথচলা)
                    </p>
                </div>
            </a>
            <nav class="flex space-x-2 md:space-x-6 text-lg items-center">
                <!-- রেসপনসিভ নেভিগেশন লিংকস -->
                <a href="#home" class="hidden md:block hover:text-amber-300 transition duration-300">হোম</a>
                <a href="#courses" class="hidden md:block hover:text-amber-300 transition duration-300">কোর্সসমূহ</a>
                <a href="#features" class="hidden md:block hover:text-amber-300 transition duration-300">বৈশিষ্ট্য</a>
                <a href="#contact" class="hidden md:block hover:text-amber-300 transition duration-300">যোগাযোগ</a>
                
                <!-- ইউজার অ্যাকশন বাটন -->
                <div id="auth-buttons" class="flex items-center">
                    <button id="signup-btn" class="bg-green-500 text-white px-3 py-1 rounded-full font-bold hover:bg-green-400 transition duration-300 text-sm md:text-base">
                        সাইনআপ
                    </button>
                    <button id="login-btn" class="bg-amber-400 text-indigo-900 px-3 py-1 rounded-full font-bold hover:bg-amber-300 transition duration-300 text-sm md:text-base ml-2">
                        লগইন
                    </button>
                </div>

                <!-- লগইন করার পর ড্যাশবোর্ড ও সাইনআউট -->
                <div id="user-info" class="hidden items-center">
                    <span id="welcome-message" class="text-amber-300 text-sm md:text-base mr-3"></span>
                    <button id="signout-btn" class="bg-red-500 text-white px-3 py-1 rounded-full font-bold hover:bg-red-400 transition duration-300 text-sm md:text-base">
                        সাইনআউট
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- লগইন/সাইনআপ মডাল (Modal) -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h4 id="auth-title" class="text-2xl font-bold text-indigo-700 mb-4 text-center">ইউজার সাইনআপ</h4>
            <p id="auth-error" class="text-red-500 text-center mb-3 hidden"></p>

            <form id="auth-form" class="space-y-4">
                <div>
                    <label for="auth-name" class="block text-gray-700 font-semibold mb-1">নাম:</label>
                    <input type="text" id="auth-name" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="আপনার পুরো নাম" required>
                </div>
                <div>
                    <label for="auth-email" class="block text-gray-700 font-semibold mb-1">ইমেইল:</label>
                    <input type="email" id="auth-email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div>
                    <label for="auth-password" class="block text-gray-700 font-semibold mb-1">পাসওয়ার্ড:</label>
                    <input type="password" id="auth-password" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                
                <div id="role-selection">
                    <p class="text-gray-700 font-semibold mb-2">আপনার ভূমিকা নির্বাচন করুন:</p>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="userRole" value="student" checked class="form-radio text-indigo-600 h-5 w-5">
                            <span class="ml-2 text-gray-700">শিক্ষার্থী</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="userRole" value="teacher" class="form-radio text-indigo-600 h-5 w-5">
                            <span class="ml-2 text-gray-700">শিক্ষক</span>
                        </label>
                    </div>
                </div>

                <!-- অতিরিক্ত ফিল্ড শুধুমাত্র শিক্ষার্থীর জন্য -->
                <div id="extra-signup-fields" class="space-y-4">
                    <p class="text-sm font-bold text-indigo-600">শিক্ষার্থীদের জন্য আবশ্যকীয় তথ্য:</p>
                    <div>
                        <label for="auth-board-id" class="block text-gray-700 font-semibold mb-1">বোর্ড আইডি (Board ID):</label>
                        <input type="text" id="auth-board-id" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="যেমন: 123456">
                    </div>
                    <div>
                        <label for="auth-birth-id" class="block text-gray-700 font-semibold mb-1">জন্ম নিবন্ধন নম্বর (Birth ID):</label>
                        <input type="text" id="auth-birth-id" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="যেমন: 2005xxxxxxxxxxxxxxx">
                    </div>
                </div>

                <!-- ক্যাপচা সেকশন শুধুমাত্র শিক্ষার্থীর জন্য -->
                <div id="captcha-section" class="bg-gray-100 p-3 rounded-lg">
                    <label for="captcha-answer" class="block text-gray-700 font-semibold mb-1">
                        নিশ্চিত করুন আপনি রোবট নন: <span id="captcha-question" class="font-bold text-indigo-700 text-xl"></span>
                    </label>
                    <input type="number" id="captcha-answer" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="যোগফল লিখুন">
                </div>
                <!-- অতিরিক্ত ফিল্ড শেষ -->

                <button type="submit" id="auth-submit" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-500 transition duration-300 flex items-center justify-center">
                    <span id="auth-spinner" class="hidden loader mr-2"></span>
                    <span id="auth-submit-text">সাইনআপ করুন</span>
                </button>
            </form>
        </div>
    </div>

    <!-- হিরো সেকশন -->
    <section id="home" class="bg-indigo-600 text-white py-16 md:py-24 animate-hero">
        <div class="container mx-auto px-4 text-center">
            <p class="text-amber-300 text-xl font-semibold mb-3">সাফল্যের ১৪ বছরের পথচলা</p>
            <h2 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">
                সিটি ইনফরমেশন টেকনোলজি ইন্সটিটিউট             </h2>
            <p class="text-xl md:text-2xl mb-8">
                টেকনোলজি নির্ভর উজ্জ্বল ভবিষ্যতের পথে আপনার প্রথম পদক্ষেপ।
            </p>
            <a href="#courses" class="bg-amber-400 text-indigo-900 text-xl font-bold px-8 py-3 rounded-xl shadow-xl hover:bg-amber-300 transform hover:scale-105 transition duration-300 inline-block">
                আসন্ন শিক্ষাবর্ষে ভর্তি চলছে! 
            </a>
            <p class="mt-4 text-lg">SSC (কারিগরি), HSC BMT, ডিপ্লোমা ইঞ্জিনিয়ারিং ও এগ্রিকালচারে ভর্তি চলছে।</p>
        </div>
    </section>

    <!-- গ্যালারি সেকশন (ছবিবিহীন - ইমোজি/আইকন নির্ভর) -->
    <section id="gallery" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 section-header mx-auto fade-in">আমাদের প্রতিষ্ঠানের কিছু চিত্র (সুবিধাসমূহ)</h3>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                
                <!-- কার্ড ১: শ্রেণিকক্ষ ও অন্যান্য কক্ষ -->
                <div class="rounded-xl shadow-lg hover:shadow-2xl card-hover fade-in gallery-card border border-indigo-200 bg-indigo-50">
                    <div class="h-32 md:h-40 flex flex-col items-center justify-center bg-indigo-100/70 p-4 rounded-t-xl">
                        <span class="text-5xl md:text-6xl text-indigo-700">📚</span>
                        <h4 class="text-xl font-bold text-indigo-800 mt-2">শ্রেণিকক্ষ ও রূমসমূহ</h4>
                    </div>
                    <div class="p-3 text-center text-base font-medium text-indigo-700 gallery-description">
                            <p>৮টি সুসজ্জিত শ্রেণিকক্ষ, প্রধান শিক্ষকের কক্ষ, শিক্ষক লাউঞ্জ এবং পরিচ্ছন্ন ওয়াশরুমের ব্যবস্থা।</p>
                    </div>
                </div>

                <!-- কার্ড ২: কম্পিউটার ল্যাব -->
                <div class="rounded-xl shadow-lg hover:shadow-2xl card-hover fade-in gallery-card border border-yellow-200 bg-yellow-50" style="transition-delay: 0.1s;">
                    <div class="h-32 md:h-40 flex flex-col items-center justify-center bg-yellow-100/70 p-4 rounded-t-xl">
                        <span class="text-5xl md:text-6xl text-yellow-700">💻</span>
                        <h4 class="text-xl font-bold text-yellow-800 mt-2">আধুনিক ল্যাব</h4>
                    </div>
                    <div class="p-3 text-center text-base font-medium text-yellow-700 gallery-description">
                        <p>আধুনিক কম্পিউটার ল্যাব, হাই-স্পিড ইন্টারনেট সুবিধা এবং প্রতিটি শিক্ষার্থীর জন্য ব্যক্তিগত কম্পিউটার।</p>
                    </div>
                </div>

                <!-- কার্ড ৩: ব্যবহারিক কাজ ও গবেষণাগার -->
                <div class="rounded-xl shadow-lg hover:shadow-2xl card-hover fade-in gallery-card border border-green-200 bg-green-50" style="transition-delay: 0.2s;">
                    <div class="h-32 md:h-40 flex flex-col items-center justify-center bg-green-100/70 p-4 rounded-t-xl">
                        <span class="text-5xl md:text-6xl text-green-700">🧪</span>
                        <h4 class="text-xl font-bold text-green-800 mt-2">ব্যবহারিক শিক্ষা</h4>
                    </div>
                    <div class="p-3 text-center text-base font-medium text-green-700 gallery-description">
                        <p>ব্যবহারিক ক্লাস ও প্রজেক্টের জন্য উন্নতমানের যন্ত্রপাতি ও বিজ্ঞান গবেষণাগার।</p>
                    </div>
                </div>

                <!-- কার্ড ৪: ক্যাম্পাস ভিউ -->
                <div class="rounded-xl shadow-lg hover:shadow-2xl card-hover fade-in gallery-card border border-red-200 bg-red-50" style="transition-delay: 0.3s;">
                    <div class="h-32 md:h-40 flex flex-col items-center justify-center bg-red-100/70 p-4 rounded-t-xl">
                        <span class="text-5xl md:text-6xl text-red-700">🏞️</span>
                        <h4 class="text-xl font-bold text-red-800 mt-2">ক্যাম্পাস পরিবেশ</h4>
                    </div>
                    <div class="p-3 text-center text-base font-medium text-red-700 gallery-description">
                        <p>মনোরম ও নিরাপদ ক্যাম্পাস, খেলাধুলার সুবিধা এবং শিক্ষার্থীদের জন্য পর্যাপ্ত বসার স্থান।</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- ড্যাশবোর্ড কন্টেইনার (লগইন করার পর দেখানোর জন্য) -->
    <section id="dashboard-view" class="py-16 bg-gray-100 hidden">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-3xl font-bold text-gray-800 section-header mx-auto">ব্যবহারকারী ড্যাশবোর্ড</h3>
            <div id="dashboard-content" class="bg-white p-4 md:p-8 rounded-xl shadow-lg mt-8 text-left max-w-4xl mx-auto">
                <!-- ড্যাশবোর্ড কনটেন্ট এখানে JavaScript দ্বারা লোড হবে -->
            </div>
        </div>
    </section>


    <!-- কোর্সের বিবরণ সেকশন -->
    <section id="courses" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 section-header mx-auto fade-in">আমাদের কোর্সসমূহ</h3>

            <!-- কোর্স কার্ডগুলো (এখন ৪টি কার্ড: ২x২ বা ৪x১) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mt-8">
                
                <!-- কোর্স 0: SSC (৯ম ও ১০ম) - কারিগরি -->
                <div class="bg-yellow-50 p-6 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 border-t-4 border-yellow-600 card-hover fade-in">
                    <h4 class="text-2xl font-bold text-yellow-700 mb-4">এস.এস.সি (কারিগরি শাখা) - ৯ম ও ১০ম শ্রেণি</h4>
                    
                    <p class="text-base font-semibold text-yellow-800 mb-2 border-b border-yellow-300 pb-1">আবশ্যিক টেকনোলজি:</p>
                    <ul class="space-y-1 text-gray-700 list-inside text-sm">
                        <!-- 51918 & 51928 - Computer Application 1st & 2nd -->
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">💻</span> কম্পিউটার অ্যাপ্লিকেশন (কোড: ৫১৯১৮/৫১৯২৮)</li>
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">✔</span> অন্যান্য আবশ্যিক বিষয়</li>
                    </ul>

                    <p class="text-base font-semibold text-yellow-800 mt-3 mb-2 border-b border-yellow-300 pb-1">ট্রেডসমূহ (প্রথম ও দ্বিতীয় পত্র):</p>
                    <ul class="space-y-1 text-gray-700 list-inside text-sm">
                        <!-- 56211, 56221 -->
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">⚡</span> জেনারেল ইলেক্ট্রনিক্স (৫৬২১১/৫৬২২১)</li>
                        <!-- 58111, 58121 -->
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">🧵</span> অ্যাপারেল ম্যানুফ্যাকচারিং বেসিকস (৫৮১১১/৫৮১২১)</li>
                        <!-- 58011, 58021 -->
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">🐔</span> পোল্ট্রি রিয়ারিং অ্যান্ড ফার্মিং (৫৮০১১/৫৮০২১)</li>
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">🌱</span> ড্রেস মেকিং ও অন্যান্য</li>
                    </ul>

                    <p class="text-base font-semibold text-yellow-800 mt-3 mb-2 border-b border-yellow-300 pb-1">ঐচ্ছিক বেসিক বিষয় (যে কোনো একটি সেট):</p>
                    <ul class="space-y-1 text-gray-700 list-inside text-sm">
                        <!-- 51811/51821, 51812/51822, 51813/51823 -->
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">➕</span> উচ্চতর গণিত সেট (৫১৮১১/৫১৮২১)</li>
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">🌾</span> কৃষিশিক্ষা সেট (৫১৮১২/৫১৮২২)</li>
                        <li class="flex items-center"><span class="text-yellow-600 mr-2">🔬</span> জীববিজ্ঞান সেট (৫১৮১৩/৫১৮২৩)</li>
                    </ul>

                    <p class="mt-3 text-sm font-bold text-yellow-700">ডিপ্লোমা ভর্তির জন্য বিশেষ সুবিধা রয়েছে।</p>
                </div>
                
                <!-- কোর্স ১: HSC (বি.এম.টি) -->
                <div class="bg-green-50 p-6 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 border-t-4 border-green-600 card-hover fade-in">
                    <h4 class="text-2xl font-bold text-green-700 mb-4">এইচ.এস.সি (বি.এম.টি)</h4>
                    <ul class="space-y-2 text-gray-700 list-inside">
                        <li class="flex items-center"><span class="text-green-600 mr-2">✔</span> কম্পিউটার অপারেশন টেকনোলজি</li>
                        <li class="flex items-center"><span class="text-green-600 mr-2">✔</span> হিউম্যান রিসোর্স (HR) টেকনোলজি</li>
                        <li class="flex items-center"><span class="text-green-600 mr-2">✔</span> উদ্যোগ টেকনোলজি</li>
                    </ul>
                </div>

                <!-- কোর্স ২: ডিপ্লোমা ইন ইঞ্জিনিয়ারিং (নতুন টেকনোলজি যোগ করা হলো) -->
                <div class="bg-blue-50 p-6 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 border-t-4 border-blue-600 card-hover fade-in">
                    <h4 class="text-2xl font-bold text-blue-700 mb-4">ডিপ্লোমা ইন ইঞ্জিনিয়ারিং</h4>
                    <ul class="space-y-2 text-gray-700 list-inside">
                        <li class="flex items-center"><span class="text-blue-600 mr-2">⚡</span> ইলেক্ট্রিক্যাল টেকনোলজি</li>
                        <li class="flex items-center"><span class="text-blue-600 mr-2">🏗️</span> সিভিল টেকনোলজি</li>
                        <li class="flex items-center"><span class="text-blue-600 mr-2">🖥️</span> কম্পিউটার টেকনোলজি</li>
                        <!-- নতুন টেকনোলজি যোগ করা হলো -->
                        <li class="flex items-center"><span class="text-blue-600 mr-2">📐</span> আর্কিটেকচার অ্যান্ড ইন্টেরিয়র ডিজাইন টেকনোলজি</li>
                    </ul>
                </div>

                <!-- কোর্স ৩: ডিপ্লোমা ইন এগ্রিকালচার -->
                <div class="bg-red-50 p-6 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 border-t-4 border-red-600 card-hover fade-in">
                    <h4 class="text-2xl font-bold text-red-700 mb-4">ডিপ্লোমা ইন এগ্রিকালচার</h4>
                    <ul class="space-y-2 text-gray-700 list-inside">
                        <li class="flex items-center"><span class="text-red-600 mr-2">✔</span> কৃষি ও ফিশারিজ টেকনোলজি</li>
                    </ul>
                </div>

            </div>
        </div>
    </section>

    <!-- বৈশিষ্ট্যের সেকশন -->
    <section id="features" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-3xl font-bold text-gray-800 section-header mx-auto fade-in">আমাদের বিশেষ বৈশিষ্ট্যসমূহ</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mt-8">
                
                <!-- বৈশিষ্ট্য ১ -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 card-hover fade-in">
                    <div class="text-4xl text-amber-500 mb-3">🎓</div>
                    <h4 class="text-xl font-semibold mb-2 text-gray-800">১০০% সাফল্যের নিশ্চয়তা</h4>
                    <p class="text-gray-600">ভালো ফলাফলের জন্য সর্বোচ্চ সহযোগিতা সহ ১০০% পাশের নিশ্চয়তা।</p>
                </div>

                <!-- বৈশিষ্ট্য ২ -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 card-hover fade-in">
                    <div class="text-4xl text-amber-500 mb-3">❌</div>
                    <h4 class="text-xl font-semibold mb-2 text-gray-800">প্রাইভেটমুক্ত শিক্ষা</h4>
                    <p class="text-gray-600">শিক্ষার্থীদেরকে আলাদা কোনো প্রাইভেট পড়ার প্রয়োজন হয় না—সময় ও অর্থ সাশ্রয়।</p>
                </div>

                <!-- বৈশিষ্ট্য ৩ -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 card-hover fade-in">
                    <div class="text-4xl text-amber-500 mb-3">💻</div>
                    <h4 class="text-xl font-semibold mb-2 text-gray-800">নিয়মিত ব্যবহারিক ক্লাস</h4>
                    <p class="text-gray-600">আধুনিক ল্যাবে দক্ষ শিক্ষকের তত্ত্বাবধানে হাতে-কলমে (Practical) শিক্ষা।</p>
                </div>

                <!-- বৈশিষ্ট্য ৪ -->
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 card-hover fade-in">
                    <div class="text-4xl text-amber-500 mb-3">🗓️</div>
                    <h4 class="text-xl font-semibold mb-2 text-gray-800">চাকরিজীবীদের বিশেষ সুবিধা</h4>
                    <p class="text-gray-600">কর্মজীবীদের জন্য ছুটির দিনে ক্লাস করার বিশেষ ব্যবস্থা রয়েছে।</p>
                </div>
            </div>
        </div>
    </section>

    <!-- যোগাযোগের সেকশন -->
    <section id="contact" class="py-16 bg-indigo-700 text-white">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-3xl font-bold section-header mx-auto border-amber-400 fade-in">ভর্তির জন্য যোগাযোগ করুন</h3>
            <p class="text-xl mb-6 mt-4 fade-in">আপনার আসন নিশ্চিত করতে দ্রুত যোগাযোগ করুন।</p>

            <div class="bg-indigo-800 p-8 rounded-xl shadow-2xl max-w-lg mx-auto fade-in">
                <p class="text-2xl font-bold mb-4">প্রতিষ্ঠান কার্যালয়:</p>
                
                <!-- সঠিক ঠিকানা আপডেট করা হয়েছে -->
                <p class="text-lg mb-4 font-semibold text-amber-200">
                    House No: 435, Block: C, Ward No: 01, Sreepur Paurashava, Sreepur, Gazipur-1740.
                </p>

                <p class="text-2xl font-bold mt-6 mb-2">যোগাযোগের মোবাইল নম্বর:</p>
                <p class="text-4xl font-extrabold text-amber-400 mb-4">
                    ০১৭১০ ০৭৭৩৩ ২
                </p>
                <p class="text-xl font-bold mb-4">
                    ০১৯৪৮ ০৭৭৮৭৩
                </p>

                <!-- Facebook বাটন যোগ করা হলো -->
                <a href="https://www.facebook.com/city.information.technology" target="_blank" 
                   class="flex items-center justify-center bg-blue-600 text-white text-xl font-bold px-6 py-3 rounded-full shadow-xl hover:bg-blue-500 transition duration-300 block mt-6">
                    <i class="fab fa-facebook-f mr-3"></i>
                    আমাদের ফেসবুক পেজ
                </a>

                <!-- যোগাযোগের CTA -->
                <a href="tel:+8801710077332" class="bg-amber-400 text-indigo-900 text-xl font-bold px-6 py-3 rounded-full shadow-xl hover:bg-amber-300 transition duration-300 block mt-4">
                    এখনই কল করুন
                </a>
            </div>
        </div>
    </section>

    <!-- ফুটার -->
    <footer class="bg-gray-900 text-gray-400 p-6 text-center text-sm">
        <div class="container mx-auto">
            &copy; ২০২৫ সিটি ইনফরমেশন টেকনোলজি ইন্সটিটিউট। সর্বস্বত্ব সংরক্ষিত।
            <!-- ফুটারের ঠিকানা ও কোড আপডেট করা হয়েছে -->
            <p class="mt-2">ঠিকানা: House No: 435, Block: C, Sreepur, Gazipur-1740.</p>
            <p class="mt-2">
                <a href="https://www.facebook.com/city.information.technology" target="_blank" class="text-indigo-400 hover:text-indigo-300 transition duration-300">
                    <i class="fab fa-facebook-f mr-1"></i> ফেসবুক
                </a>
            </p>
        </div>
    </footer>

    <!-- স্ক্রিপ্ট -->
    <script>
        // DOM উপাদান নির্বাচন
        const authModal = document.getElementById('auth-modal');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const closeBtn = document.querySelector('.close-btn');
        const authForm = document.getElementById('auth-form');
        const authTitle = document.getElementById('auth-title');
        const authSubmit = document.getElementById('auth-submit');
        const authSubmitText = document.getElementById('auth-submit-text');
        const authSpinner = document.getElementById('auth-spinner');
        const authError = document.getElementById('auth-error');
        const roleSelection = document.getElementById('role-selection');
        const authButtons = document.getElementById('auth-buttons');
        const userInfo = document.getElementById('user-info');
        const signoutBtn = document.getElementById('signout-btn');
        const dashboardView = document.getElementById('dashboard-view');
        const dashboardContent = document.getElementById('dashboard-content');
        const welcomeMessage = document.getElementById('welcome-message');
        const extraSignupFields = document.getElementById('extra-signup-fields');
        const captchaSection = document.getElementById('captcha-section');
        const roleRadios = document.querySelectorAll('input[name="userRole"]');

        const authEmailInput = document.getElementById('auth-email');
        const authPasswordInput = document.getElementById('auth-password');
        const authNameInput = document.getElementById('auth-name');
        const authBoardIdInput = document.getElementById('auth-board-id');
        const authBirthIdInput = document.getElementById('auth-birth-id');
        const captchaQuestionSpan = document.getElementById('captcha-question');
        const captchaAnswerInput = document.getElementById('captcha-answer');

        // Captcha variable
        window.captchaAnswer = 0;
        let isLoginMode = true; // প্রাথমিক মোড লগইন
        
        // Gemini API Setup
        const apiKey = ""; 
        const geminiApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // Function for exponential backoff delay
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Function to call the Gemini API with backoff (Completed)
        async function callGeminiAPI(systemInstruction, userQuery) {
            const maxRetries = 5;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        tools: [{ "google_search": {} }], // Use Google Search for grounding
                        systemInstruction: {
                            parts: [{ text: systemInstruction }]
                        },
                    };

                    const response = await fetch(geminiApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];

                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            return candidate.content.parts[0].text;
                        }
                        throw new Error("Invalid API response structure.");
                    } else if (response.status === 429) {
                        console.warn(`Rate limit exceeded. Retrying in ${Math.pow(2, i) * 1000}ms...`);
                        await delay(Math.pow(2, i) * 1000 + Math.random() * 1000); // Exponential backoff with jitter
                    } else {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Gemini API call failed after multiple retries:", error);
                        return "দুঃখিত, এআই পরিষেবা বর্তমানে উপলব্ধ নয়। পরে চেষ্টা করুন।"; // Sorry, AI service is not available now. Try later.
                    }
                    await delay(Math.pow(2, i) * 1000 + Math.random() * 500);
                }
            }
            return "দুঃখিত, এআই পরিষেবা থেকে কোনো উত্তর পাওয়া যায়নি।"; // Sorry, no answer received from AI service.
        }

        // ক্যাপচা তৈরি করা
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            window.captchaAnswer = num1 + num2;
            captchaQuestionSpan.textContent = `${num1} + ${num2} = ?`;
            captchaAnswerInput.value = '';
        }

        // ইউজার প্রোফাইল ডেটা Firestore এ সংরক্ষণ করা
        async function saveUserProfile(uid, role, name, boardId = null, birthId = null) {
            if (!window.db || !window.appId) return;
            const userRef = doc(window.db, `artifacts/${window.appId}/users/${uid}/user_data/profile`);
            
            const profileData = {
                role: role,
                name: name,
                email: window.auth.currentUser.email,
                lastLogin: new Date().toISOString()
            };

            if (role === 'student') {
                profileData.boardId = boardId;
                profileData.birthId = birthId;
            }

            try {
                await setDoc(userRef, profileData, { merge: true });
                console.log("User profile saved successfully.");
                return true;
            } catch (error) {
                console.error("Error saving user profile:", error);
                return false;
            }
        }

        // লগইন হ্যান্ডলার
        async function handleLogin(email, password) {
            try {
                const userCredential = await signInWithEmailAndPassword(window.auth, email, password);
                const user = userCredential.user;
                // লগইন সফল হলে UI আপডেট হবে onAuthStateChanged listener এর মাধ্যমে
                return true;
            } catch (error) {
                let errorMessage = "লগইন ব্যর্থ হয়েছে। ইমেইল বা পাসওয়ার্ড ভুল।";
                if (error.code === 'auth/user-not-found') {
                    errorMessage = "এই ইমেইল দিয়ে কোনো ইউজার পাওয়া যায়নি।";
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = "পাসওয়ার্ড ভুল।";
                }
                authError.textContent = errorMessage;
                authError.classList.remove('hidden');
                return false;
            }
        }

        // সাইনআপ হ্যান্ডলার
        async function handleSignUp(email, password, name, role, boardId, birthId, captchaResponse) {
            // ক্যাপচা চেক (শুধুমাত্র শিক্ষার্থীর জন্য)
            if (role === 'student' && parseInt(captchaResponse) !== window.captchaAnswer) {
                authError.textContent = "ক্যাপচা উত্তর ভুল হয়েছে। আবার চেষ্টা করুন।";
                authError.classList.remove('hidden');
                generateCaptcha(); // নতুন ক্যাপচা তৈরি
                return false;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(window.auth, email, password);
                const user = userCredential.user;

                // প্রোফাইল ডেটা সংরক্ষণ
                await saveUserProfile(user.uid, role, name, boardId, birthId);

                // সফল সাইনআপের পর onAuthStateChanged listener UI আপডেট করবে
                return true;
            } catch (error) {
                let errorMessage = "সাইনআপ ব্যর্থ হয়েছে।";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "এই ইমেইলটি ইতিমধ্যেই ব্যবহৃত হয়েছে। লগইন করুন।";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "পাসওয়ার্ডটি খুবই দুর্বল। কমপক্ষে ৬ অক্ষরের পাসওয়ার্ড দিন।";
                }
                authError.textContent = errorMessage;
                authError.classList.remove('hidden');
                return false;
            }
        }

        // মডাল UI এবং মোড পরিবর্তন
        function setModalMode(isLogin) {
            isLoginMode = isLogin;
            authForm.reset();
            authError.classList.add('hidden');
            
            const titleText = isLogin ? "ইউজার লগইন" : "ইউজার সাইনআপ";
            const buttonText = isLogin ? "লগইন করুন" : "সাইনআপ করুন";
            
            authTitle.textContent = titleText;
            authSubmitText.textContent = buttonText;
            authNameInput.closest('div').classList.toggle('hidden', isLogin);
            roleSelection.classList.toggle('hidden', isLogin);
            
            // সাইনআপ মোডে শিক্ষার্থীর জন্য অতিরিক্ত ফিল্ড দেখানো
            const selectedRole = document.querySelector('input[name="userRole"]:checked')?.value || 'student';
            const isStudent = selectedRole === 'student' && !isLogin;

            extraSignupFields.classList.toggle('hidden', !isStudent);
            captchaSection.classList.toggle('hidden', !isStudent);
            
            if (!isLogin) {
                generateCaptcha();
            }

            // লগইনের সময় অতিরিক্ত ফিল্ড দরকার নেই
            authBoardIdInput.required = isStudent;
            authBirthIdInput.required = isStudent;
            captchaAnswerInput.required = isStudent;
        }

        // রোল পরিবর্তনের হ্যান্ডলার (শুধুমাত্র সাইনআপ মোডে)
        roleRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (!isLoginMode) {
                    const isStudent = e.target.value === 'student';
                    extraSignupFields.classList.toggle('hidden', !isStudent);
                    captchaSection.classList.toggle('hidden', !isStudent);
                    
                    if (isStudent) {
                        generateCaptcha();
                    }

                    // প্রয়োজনীয়তা সেট করা
                    authBoardIdInput.required = isStudent;
                    authBirthIdInput.required = isStudent;
                    captchaAnswerInput.required = isStudent;
                }
            });
        });

        // ফর্ম সাবমিট হ্যান্ডলার
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            authError.classList.add('hidden');
            
            const email = authEmailInput.value.trim();
            const password = authPasswordInput.value.trim();
            const name = authNameInput.value.trim();
            const role = document.querySelector('input[name="userRole"]:checked')?.value;
            const boardId = authBoardIdInput.value.trim();
            const birthId = authBirthIdInput.value.trim();
            const captchaResponse = captchaAnswerInput.value.trim();

            if (!email || !password || (!isLoginMode && !name)) {
                authError.textContent = "দয়া করে সব ফিল্ড পূরণ করুন।";
                authError.classList.remove('hidden');
                return;
            }

            // স্পিনার চালু
            authSubmitText.textContent = isLoginMode ? "লগইন হচ্ছে..." : "সাইনআপ হচ্ছে...";
            authSpinner.classList.remove('hidden');
            authSubmit.disabled = true;

            let success = false;
            
            if (isLoginMode) {
                success = await handleLogin(email, password);
            } else {
                success = await handleSignUp(email, password, name, role, boardId, birthId, captchaResponse);
            }

            // স্পিনার বন্ধ
            authSubmitText.textContent = isLoginMode ? "লগইন করুন" : "সাইনআপ করুন";
            authSpinner.classList.add('hidden');
            authSubmit.disabled = false;

            if (success) {
                authModal.style.display = 'none';
            }
        });

        // সাইনআউট হ্যান্ডলার
        signoutBtn.addEventListener('click', async () => {
            try {
                await window.auth.signOut();
                console.log("User signed out.");
            } catch (error) {
                console.error("Signout failed:", error);
            }
        });

        // মডাল খোলার ইভেন্ট
        loginBtn.addEventListener('click', () => {
            if (window.isAuthReady) {
                setModalMode(true);
                authModal.style.display = 'block';
            }
        });

        signupBtn.addEventListener('click', () => {
            if (window.isAuthReady) {
                setModalMode(false);
                authModal.style.display = 'block';
            }
        });

        // মডাল বন্ধের ইভেন্ট
        closeBtn.addEventListener('click', () => {
            authModal.style.display = 'none';
        });
        window.onclick = function(event) {
            if (event.target == authModal) {
                authModal.style.display = 'none';
            }
        };

        // UI আপডেট ফাংশন
        function updateUIForUser() {
            if (!window.isAuthReady) return;

            const user = window.auth?.currentUser;
            const role = window.currentUserRole;
            const userName = window.currentUserName;

            if (user && !user.isAnonymous) {
                // লগইন করা ইউজার
                authButtons.classList.add('hidden');
                userInfo.classList.remove('hidden');
                userInfo.classList.add('flex');
                
                welcomeMessage.textContent = `স্বাগতম, ${userName} (${role === 'student' ? 'শিক্ষার্থী' : 'শিক্ষক'})!`;

                // ড্যাশবোর্ড দেখাও
                dashboardView.classList.remove('hidden');
                renderDashboard(role);
            } else {
                // লগআউট করা বা অ্যানোনিমাস ইউজার
                authButtons.classList.remove('hidden');
                userInfo.classList.add('hidden');
                userInfo.classList.remove('flex');
                dashboardView.classList.add('hidden');
            }

            // গ্যালারি ও অন্যান্য সেকশনগুলোতে ফেড-ইন অ্যানিমেশন যোগ করা
            document.querySelectorAll('.fade-in').forEach(el => el.classList.add('appear'));
        }
        
        // ড্যাশবোর্ড কন্টেন্ট রেন্ডার করা
        function renderDashboard(role) {
            dashboardContent.innerHTML = `
                <h4 class="text-2xl font-bold mb-4 text-indigo-700">স্বাগতম, ${window.currentUserName}!</h4>
                <p class="mb-4 text-gray-700">আপনার ইউজার আইডি: <code class="text-sm bg-gray-200 p-1 rounded-md">${window.currentUserId}</code></p>
            `;

            if (role === 'student') {
                renderStudentDashboard();
            } else if (role === 'teacher') {
                renderTeacherDashboard();
            }
        }
        
        // স্টুডেন্ট ড্যাশবোর্ড: AI Academic Assistant
        function renderStudentDashboard() {
            dashboardContent.innerHTML += `
                <div class="mt-8">
                    <h5 class="text-xl font-bold text-green-700 mb-4 border-b pb-2">এআই একাডেমিক সহায়ক</h5>
                    <p class="mb-4 text-gray-600">আমাদের কোর্স বা কারিগরি বিষয়বস্তু নিয়ে যেকোনো প্রশ্ন করুন। এআই আপনাকে সঠিক উত্তর খুঁজে দেবে।</p>
                    
                    <div id="ai-chat-box" class="chat-container">
                        <div class="ai-message chat-message">
                            নমস্কার! আমি সিটিআইটিআই-এর এআই সহকারী। আপনি এসএসসি ট্রেড, ডিপ্লোমা বা অন্য যেকোনো বিষয়ে প্রশ্ন করতে পারেন।
                        </div>
                    </div>
                    
                    <div class="mt-4 flex space-x-2">
                        <input type="text" id="ai-input" placeholder="আপনার প্রশ্নটি লিখুন..." class="w-full p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button id="ai-send-btn" class="bg-indigo-600 text-white p-3 rounded-r-lg font-bold hover:bg-indigo-500 transition duration-300 flex items-center justify-center">
                            <span id="ai-spinner" class="hidden loader mr-2"></span>
                            <span>জিজ্ঞাসা করুন</span>
                        </button>
                    </div>
                </div>
            `;

            const aiChatBox = document.getElementById('ai-chat-box');
            const aiInput = document.getElementById('ai-input');
            const aiSendBtn = document.getElementById('ai-send-btn');
            const aiSpinner = document.getElementById('ai-spinner');

            aiSendBtn.addEventListener('click', async () => {
                const userQuery = aiInput.value.trim();
                if (!userQuery) return;
                
                // ইউজার মেসেজ ডিসপ্লে
                const userMsgEl = document.createElement('div');
                userMsgEl.className = 'user-message chat-message';
                userMsgEl.textContent = userQuery;
                aiChatBox.appendChild(userMsgEl);
                aiChatBox.scrollTop = aiChatBox.scrollHeight;
                aiInput.value = '';

                // এআই প্রসেসিং শুরু
                aiSendBtn.disabled = true;
                aiSpinner.classList.remove('hidden');
                aiSendBtn.querySelector('span:last-child').textContent = 'প্রসেসিং...';

                const systemPrompt = `আপনি সিটি ইনফরমেশন টেকনোলজি ইন্সটিটিউট-এর একজন একাডেমিক সহকারী। বাংলায় উত্তর দিন। আপনার উত্তর অবশ্যই সংক্ষিপ্ত, সহায়ক এবং শিক্ষামূলক হবে। যদি প্রশ্নটি টেকনোলজি বা একাডেমিক বিষয় সম্পর্কিত না হয়, তাহলে বিনয়ের সাথে বলুন যে আপনি শুধু শিক্ষা সংক্রান্ত বিষয়ে সাহায্য করতে পারেন।`;
                
                const aiResponse = await callGeminiAPI(systemPrompt, userQuery);

                // এআই মেসেজ ডিসপ্লে
                const aiMsgEl = document.createElement('div');
                aiMsgEl.className = 'ai-message chat-message';
                aiMsgEl.innerHTML = aiResponse.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                aiChatBox.appendChild(aiMsgEl);
                aiChatBox.scrollTop = aiChatBox.scrollHeight;

                // প্রসেসিং শেষ
                aiSendBtn.disabled = false;
                aiSpinner.classList.add('hidden');
                aiSendBtn.querySelector('span:last-child').textContent = 'জিজ্ঞাসা করুন';
            });
        }
        
        // টিচার ড্যাশবোর্ড: নোটিশ ম্যানেজমেন্ট
        let noticeUnsubscribe = null;

        function renderTeacherDashboard() {
            dashboardContent.innerHTML += `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
                    <!-- নোটিশ পোস্ট সেকশন -->
                    <div>
                        <h5 class="text-xl font-bold text-red-700 mb-4 border-b pb-2">নতুন নোটিশ পোস্ট করুন</h5>
                        <form id="notice-form" class="space-y-4 bg-red-50 p-4 rounded-lg border border-red-200">
                            <div>
                                <label for="notice-title" class="block text-gray-700 font-semibold mb-1">শিরোনাম:</label>
                                <input type="text" id="notice-title" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" required>
                            </div>
                            <div>
                                <label for="notice-body" class="block text-gray-700 font-semibold mb-1">নোটিশের বিবরণ:</label>
                                <textarea id="notice-body" rows="5" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" required></textarea>
                            </div>
                            <button type="submit" id="notice-submit" class="bg-red-600 text-white p-2 rounded-lg font-bold hover:bg-red-500 transition duration-300 w-full">
                                নোটিশ পোস্ট করুন
                            </button>
                            <p id="notice-message" class="text-sm text-center text-green-600 hidden mt-2">নোটিশ সফলভাবে পোস্ট করা হয়েছে!</p>
                        </form>
                    </div>

                    <!-- সাম্প্রতিক নোটিশসমূহ -->
                    <div>
                        <h5 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">সাম্প্রতিক নোটিশসমূহ</h5>
                        <div id="notice-list" class="space-y-3">
                            <p class="text-center text-gray-500">নোটিশ লোড হচ্ছে...</p>
                        </div>
                    </div>
                </div>
            `;
            
            // নোটিশ সাবমিট হ্যান্ডলার
            document.getElementById('notice-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const title = document.getElementById('notice-title').value.trim();
                const body = document.getElementById('notice-body').value.trim();
                const submitBtn = document.getElementById('notice-submit');
                const msgEl = document.getElementById('notice-message');

                submitBtn.disabled = true;
                submitBtn.textContent = 'পোস্ট করা হচ্ছে...';
                msgEl.classList.add('hidden');

                if (!window.db || !window.appId) return;

                const noticesCollectionRef = collection(window.db, `artifacts/${window.appId}/public/data/notices`);
                
                try {
                    await addDoc(noticesCollectionRef, {
                        title: title,
                        body: body,
                        timestamp: new Date().toISOString(),
                        authorId: window.currentUserId,
                        authorName: window.currentUserName
                    });
                    
                    msgEl.textContent = 'নোটিশ সফলভাবে পোস্ট করা হয়েছে!';
                    msgEl.classList.remove('hidden');
                    document.getElementById('notice-form').reset();
                } catch (error) {
                    console.error("Error posting notice:", error);
                    msgEl.textContent = 'পোস্ট করতে সমস্যা হয়েছে।';
                    msgEl.classList.remove('hidden');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'নোটিশ পোস্ট করুন';
                }
            });

            // রিয়েল-টাইম নোটিশ লোডিং (onSnapshot)
            if (noticeUnsubscribe) {
                noticeUnsubscribe();
            }

            if (window.db && window.appId) {
                const noticesCollectionRef = collection(window.db, `artifacts/${window.appId}/public/data/notices`);
                // Firestore-এ orderBy ব্যবহার এড়ানো হয়েছে, তাই সব ডেটা এনে JS-এ সর্ট করা হবে
                const q = query(noticesCollectionRef);

                noticeUnsubscribe = onSnapshot(q, (snapshot) => {
                    let notices = [];
                    snapshot.forEach((doc) => {
                        notices.push({ id: doc.id, ...doc.data() });
                    });

                    // JS-এ টাইমস্ট্যাম্প অনুসারে সর্ট করা (সাম্প্রতিকতম প্রথমে)
                    notices.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    const noticeList = document.getElementById('notice-list');
                    noticeList.innerHTML = '';
                    
                    if (notices.length === 0) {
                        noticeList.innerHTML = `<p class="text-center text-gray-500">এখনও কোনো নোটিশ পোস্ট করা হয়নি।</p>`;
                        return;
                    }
                    
                    notices.slice(0, 5).forEach(notice => { // শুধুমাত্র প্রথম ৫টি দেখানো
                        const date = new Date(notice.timestamp).toLocaleDateString('bn-BD');
                        const time = new Date(notice.timestamp).toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
                        
                        const noticeEl = document.createElement('div');
                        noticeEl.className = 'bg-gray-50 p-3 rounded-lg border-l-4 border-indigo-500 shadow-sm';
                        noticeEl.innerHTML = `
                            <p class="text-lg font-bold text-indigo-800">${notice.title}</p>
                            <p class="text-gray-700 mt-1 text-sm">${notice.body}</p>
                            <p class="text-xs text-gray-500 mt-2">
                                পোস্ট করেছেন: ${notice.authorName} (${date} ${time})
                            </p>
                        `;
                        noticeList.appendChild(noticeEl);
                    });
                }, (error) => {
                    console.error("Error fetching notices:", error);
                    document.getElementById('notice-list').innerHTML = `<p class="text-center text-red-500">নোটিশ লোড করতে সমস্যা হয়েছে।</p>`;
                });
            }
        }
        
        // যখন উইন্ডো লোড হয়, UI আপডেট নিশ্চিত করা
        if (window.isAuthReady) {
            updateUIForUser();
        } else {
            // যদি onAuthStateChanged এখনও ফায়ার না হয়ে থাকে, অপেক্ষা করা হবে
            window.addEventListener('load', () => {
                updateUIForUser();
            });
        }
    </script>
</body>
</html>
